# HeavenClient Build Instructions

This guide will help you compile and run the HeavenClient on Windows.

## Prerequisites

- Windows 10/11
- Visual Studio 2019 Community (or newer)
- Windows SDK 8.1
- Platform Toolset v140 (Visual Studio 2015 Build Tools)

## Quick Start

1. **Install Dependencies** (run as Administrator):
   ```batch
   install_dependencies.bat
   ```

2. **Build the Client**:
   ```batch
   build.bat
   ```

3. **Run the Client**:
   ```batch
   run_client.bat
   ```

## Detailed Instructions

### 1. Install Visual Studio 2019

1. Download Visual Studio 2019 Community from: https://visualstudio.microsoft.com/downloads/
2. During installation, select:
   - Desktop development with C++
   - Windows 10 SDK
   - MSVC v142 - VS 2019 C++ x64/x86 build tools
   - MSVC v140 - VS 2015 C++ build tools (for v140 toolset)

### 2. Install Windows SDK 8.1

1. Download from: https://developer.microsoft.com/en-us/windows/downloads/sdk-archive
2. Install "Windows SDK for Windows 8.1"

### 3. Set up WZ to NX Conversion

The client requires NX files (converted from WZ files). You have WZ files at:
`C:\Users\me\Downloads\PERISH\MapleStory`

1. Download NoLifeWzToNx from: https://github.com/ryantpayton/NoLifeWzToNx/releases
2. Extract `NoLifeWzToNx.exe` to the `NoLifeWzToNx` folder
3. Run `setup_nx_conversion.bat` to convert WZ files to NX format

### 4. Build the Client

Run `build.bat` to compile the client. Options:
- `build.bat` - Build Release x64 (default)
- `build.bat debug` - Build Debug x64
- `build.bat release x86` - Build Release x86
- `build.bat debug x86` - Build Debug x86

### 5. Run the Client

Run `run_client.bat` to launch the client. This script will:
- Check for the executable
- Verify NX files are present
- Launch the client with proper settings

## File Structure

After building, your directory should look like:
```
HeavenClient/
├── x64/Release/MapleStory.exe    # Main executable
├── Base.nx                       # Game data files
├── Character.nx
├── Effect.nx
├── Etc.nx
├── Item.nx
├── Map.nx
├── Mob.nx
├── Morph.nx
├── Npc.nx
├── Quest.nx
├── Reactor.nx
├── Skill.nx
├── Sound.nx
├── String.nx
├── TamingMob.nx
├── UI.nx
└── includes/                     # All dependencies included
```

## Dependencies Included

All required dependencies are included in the `includes/` folder:
- **GLEW 2.1.0** - OpenGL extensions
- **GLFW 3.3.2** - Windowing and input
- **FreeType** - Font rendering
- **Bass 2.4** - Audio library
- **NoLifeNx** - NX file handling
- **STB** - Image loading

## Build Scripts

- `install_dependencies.bat` - Checks and installs required tools
- `build.bat` - Compiles the client
- `setup_nx_conversion.bat` - Converts WZ files to NX format
- `run_client.bat` - Launches the client with checks

## Troubleshooting

### Build Errors

**Missing Windows SDK 8.1:**
```
Download from: https://developer.microsoft.com/en-us/windows/downloads/sdk-archive
```

**Missing Platform Toolset v140:**
```
Install Visual Studio 2015 Build Tools or add v140 toolset to VS 2019
```

**Link errors:**
```
Make sure all dependencies are in the includes/ folder
```

### Runtime Errors

**Missing DLLs:**
```
The build script automatically copies required DLLs to the output folder
```

**Client crashes on startup:**
```
1. Check that all NX files are present
2. Verify debug.log for error details
3. Make sure Visual C++ Redistributables are installed
```

**Missing NX files:**
```
Run setup_nx_conversion.bat to convert WZ files
```

### Clean Build

If you encounter issues, try a clean build:
```batch
# Delete build artifacts
rmdir /s /q x64
rmdir /s /q x86  
rmdir /s /q .vs
del debug.log
del MapleStory.aps
del Settings

# Rebuild
build.bat
```

## Configuration

Edit `MapleStory.h` to configure build options:
- `USE_ASIO`: Use Asio for networking (requires additional setup)
- `USE_CRYPTO`: Use cryptography for server communication
- `USE_NX`: Use NX files instead of WZ files (recommended)
- `USE_DEBUG`: Enable debug features

Edit `Configuration.h` to change default settings (server address, resolution, etc.)

## Server Connection

The client is designed to work with version 83 servers. Make sure to:
1. Configure the server address in `Configuration.h`
2. Ensure the server is running and accessible
3. Check that client and server versions match

## Support

For issues specific to this build setup, check:
1. The console output from build scripts
2. Visual Studio build output
3. The `debug.log` file generated by the client
4. Original project README.md for general client information